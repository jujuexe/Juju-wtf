<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juju Casino ‚Äì Mines</title>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: 'Arial', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .game-container {
      text-align: center;
      width: 100%;
      max-width: 600px;
      padding: 20px;
      position: relative;
    }

    h1 {
      font-size: 48px;
      color: #f0f0f0;
      margin-bottom: 20px;
    }

    #token-count {
      font-size: 22px;
      margin-bottom: 20px;
    }

    .button-container {
      margin-top: 20px;
    }

    /* Return to Casino Button */
    .return-button {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 10px 15px;
      background: #444;
      border-radius: 5px;
      text-decoration: none;
      color: white;
      font-size: 18px;
      transition: background 0.3s ease;
    }

    .return-button:hover {
      background-color: #0f0;
    }

    /* Game Grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      grid-gap: 10px;
      margin-top: 20px;
    }

    .tile {
      width: 60px;
      height: 60px;
      background: #222;
      border: 1px solid #444;
      cursor: pointer;
      font-size: 24px;
      line-height: 60px;
      user-select: none;
      text-align: center;
    }

    .tile.revealed {
      background: #1e1e1e;
      color: #0f0;
    }

    .tile.mine {
      background: #900;
      color: #fff;
    }

    .tile.locked {
      cursor: not-allowed;
      background: #666;
    }

    .input-container {
      margin-top: 20px;
    }

    .cashout-display {
      font-size: 20px;
      margin-top: 20px;
    }

    /* Start Button and Cashout */
    .start-button {
      padding: 15px 30px;
      font-size: 20px;
      background: #444;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .start-button:hover {
      background-color: #0f0;
    }

    .hidden {
      display: none;
    }

    .bet-input {
      padding: 10px;
      font-size: 16px;
      margin-right: 10px;
      background: #333;
      color: white;
      border: none;
      border-radius: 5px;
      width: 100px;
    }
  </style>
</head>
<body>

  <div class="game-container">

    <!-- Return to Casino Button -->
    <a href="/casino" class="return-button">‚Üê Return to Casino</a>

    <h1>Mines Game <span>üí£</span></h1>

    <p id="token-count">Balance: <span id="balance">1000</span> Tokens</p>

    <!-- Bet Size Input -->
    <div class="input-container">
      <label for="bet-size">Bet Size:</label>
      <input type="number" id="bet-size" class="bet-input" min="1" max="100" value="10">
    </div>

    <!-- Grid for Mines -->
    <div class="grid">
      <!-- Tiles will be dynamically generated here -->
    </div>

    <!-- Start Game Button -->
    <button class="start-button" id="start-button" onclick="startGame()">Start Game</button>

    <!-- Cashout and Multiplier Display -->
    <div class="cashout-display hidden" id="cashout-display">
      <p>Multiplier: <span id="multiplier">1x</span></p>
      <p>Cashout: <span id="cashout-amount">0</span> Tokens</p>
    </div>

  </div>

  <script>
    // Variables
    let balance = 1000;
    let betSize = 10;
    let gridSize = 25;
    let mineCount = 5;
    let revealedTiles = 0;
    let multiplier = 1;
    let tiles = [];

    // Initialize the game grid
    function createGrid() {
      const gridElement = document.querySelector('.grid');
      gridElement.innerHTML = ''; // Clear existing grid
      tiles = [];
      for (let i = 0; i < gridSize; i++) {
        const tile = document.createElement('div');
        tile.classList.add('tile');
        tile.setAttribute('data-index', i);
        tile.addEventListener('click', handleTileClick);
        gridElement.appendChild(tile);
        tiles.push(tile);
      }
    }

    // Start the game
    function startGame() {
      betSize = parseInt(document.getElementById('bet-size').value);
      if (betSize > balance) {
        alert("Insufficient balance for this bet.");
        return;
      }
      balance -= betSize; // Debit balance
      document.getElementById('balance').textContent = balance;

      document.getElementById('start-button').classList.add('hidden');
      document.getElementById('cashout-display').classList.remove('hidden');

      multiplier = 1; // Reset multiplier
      revealedTiles = 0;

      createGrid();
      setMines();
    }

    // Handle tile click
    function handleTileClick(event) {
      const tile = event.target;
      const index = parseInt(tile.getAttribute('data-index'));

      if (tile.classList.contains('revealed') || tile.classList.contains('locked')) return;

      tile.classList.add('revealed');

      if (Math.random() < (mineCount / gridSize)) {
        tile.classList.add('mine');
        endGame(false); // End game on mine
      } else {
        revealedTiles++;
        multiplier = 1 + (revealedTiles / gridSize); // Increase multiplier
        document.getElementById('multiplier').textContent = `${multiplier.toFixed(2)}x`;
      }

      // Check if all non-mine tiles are revealed (win condition)
      if (revealedTiles === gridSize - mineCount) {
        endGame(true); // End game with win
      }
    }

    // Set mines randomly
    function setMines() {
      const mineIndices = [];
      while (mineIndices.length < mineCount) {
        const randIndex = Math.floor(Math.random() * gridSize);
        if (!mineIndices.includes(randIndex)) {
          mineIndices.push(randIndex);
        }
      }

      tiles.forEach((tile, index) => {
        if (mineIndices.includes(index)) {
          tile.classList.add('mine');
        }
      });
    }

    // End the game
    function endGame(win) {
      if (win) {
        const cashoutAmount = betSize * multiplier;
        document.getElementById('cashout-amount').textContent = cashoutAmount;
        balance += cashoutAmount; // Add winnings
        document.getElementById('balance').textContent = balance;
        alert("You won! Cashout: " + cashoutAmount);
      } else {
        alert("Game over! You hit a mine!");
      }

      document.getElementById('start-button').classList.remove('hidden');
      document.getElementById('cashout-display').classList.add('hidden');
      revealedTiles = 0;
    }
  </script>

</body>
</html>
